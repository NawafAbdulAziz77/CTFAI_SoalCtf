<?php
$target_dir = "uploads/";
$uploadOk = 0; // default gagal

// Buat folder jika belum ada
if (!is_dir($target_dir)) {
    mkdir($target_dir, 0777, true);
}

// Cek apakah form disubmit dan file tersedia
if (isset($_POST["submit"]) && isset($_FILES["fileToUpload"])) {
    $file = $_FILES["fileToUpload"];
    
    if ($file["error"] !== UPLOAD_ERR_OK) {
        echo "Upload error: " . $file["error"] . "<br>";
    } else {
        $target_file = $target_dir . basename($file["name"]);
        $imageFileType = strtolower(pathinfo($target_file, PATHINFO_EXTENSION));

        // Cek apakah file valid gambar
        $check = getimagesize($file["tmp_name"]);
        if ($check !== false) {
            echo "File is an image - " . $check["mime"] . ".<br>";
        } else {
            echo "File is not an image.<br>";
        }

        // Cek jika file sudah ada
        if (file_exists($target_file)) {
            echo "Sorry, file already exists.<br>";
        }
        // Cek ukuran
        elseif ($file["size"] > 500000) {
            echo "Sorry, your file is too large.<br>";
        }
        // ðŸ”“ Celah: asal ada .jpg di nama file
        elseif (str_contains($file["name"], ".jpg")) {
            if (move_uploaded_file($file["tmp_name"], $target_file)) {
                echo "The file " . htmlspecialchars(basename($file["name"])) . " has been uploaded.<br>";
                $uploadOk = 1;
            } else {
                echo "Sorry, there was an error uploading your file.<br>";
            }
        } else {
            echo "Sorry, only files with .jpg in the name are allowed.<br>";
        }
    }
} else {
    echo "No file uploaded.<br>";
}
?>
