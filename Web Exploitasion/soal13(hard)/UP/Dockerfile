FROM php:8.1-apache

# Install ekstensi mysqli
RUN docker-php-ext-install mysqli

# Aktifkan mod_rewrite dan mod_mime untuk dukung .htaccess
RUN a2enmod rewrite mime

# Izinkan penggunaan .htaccess di seluruh direktori Apache
RUN sed -i 's/AllowOverride None/AllowOverride All/g' /etc/apache2/apache2.conf

# Salin seluruh konten web ke dalam root web server Apache
COPY soal13/ /var/www/html/

# Salin file flag.php ke luar direktori web (tidak bisa diakses langsung via browser)
COPY flag.php /flag.php

# Buat folder uploads (jika belum ada) dan beri permission supaya bisa upload
RUN mkdir -p /var/www/html/uploads && chmod -R 777 /var/www/html/uploads

# Salin file .htaccess ke dalam folder uploads (agar .jpg bisa dianggap PHP)
COPY soal13/uploads/.htaccess /var/www/html/uploads/.htaccess
