FROM php:8.1-apache

# Install ekstensi PHP dan aktifkan mod_rewrite, mod_mime
RUN docker-php-ext-install mysqli && \
    a2enmod rewrite mime && \
    sed -i 's/AllowOverride None/AllowOverride All/g' /etc/apache2/apache2.conf

# Salin semua file ke direktori web
COPY soal13/ /var/www/html/

# Salin flag ke luar direktori web
COPY flag.php /flag.php

# Siapkan folder uploads dengan permission penuh
RUN mkdir -p /var/www/html/uploads && \
    chmod -R 777 /var/www/html/uploads

# Salin htaccess untuk behavior upload (misal: .jpg bisa dieksekusi)
COPY soal13/uploads/.htaccess /var/www/html/uploads/.htaccess
